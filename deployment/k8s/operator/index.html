<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Chaos Toolkit"><meta name=author content="The Chaos Toolkit Team"><link rel="shortcut icon" href=../../../static/images/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.7"><title>Operator - Chaos Toolkit</title><link rel=stylesheet href=../../../assets/stylesheets/main.b8ac9624.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.28f3ef9a.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../static/css/extra.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-107338053-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=white data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#deploy-chaos-toolkit-as-a-kubernetes-operator class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title="Chaos Toolkit" class="md-header-nav__button md-logo" aria-label="Chaos Toolkit"> <img src=../../../static/images/logo.png alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Chaos Toolkit </span> <span class="md-header-nav__topic md-ellipsis"> Operator </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/chaostoolkit/chaostoolkit/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> chaostoolkit </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Chaos Toolkit" class="md-nav__button md-logo" aria-label="Chaos Toolkit"> <img src=../../../static/images/logo.png alt=logo> </a> Chaos Toolkit </label> <div class=md-nav__source> <a href=https://github.com/chaostoolkit/chaostoolkit/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> chaostoolkit </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Usage <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Usage data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Usage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/usage/install/ title=Install class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/upgrade/ title=Upgrade class=md-nav__link> Upgrade </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> CLI <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CLI data-md-level=2> <label class=md-nav__title for=nav-2-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/usage/cli/ title=Overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/discover/ title=Discover class=md-nav__link> Discover </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/init/ title=Init class=md-nav__link> Init </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/run/ title=Run class=md-nav__link> Run </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/report/ title=Report class=md-nav__link> Report </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/notification/ title=Notify class=md-nav__link> Notify </a> </li> <li class=md-nav__item> <a href=../../../reference/usage/scheduling/ title=Schedule class=md-nav__link> Schedule </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Deployment <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Deployment data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1 checked> <label class=md-nav__link for=nav-3-1> Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Operator <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title=Operator class="md-nav__link md-nav__link--active"> Operator </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#deploy-the-operator class=md-nav__link> Deploy the operator </a> </li> <li class=md-nav__item> <a href=#run-an-experiment class=md-nav__link> Run an experiment </a> </li> <li class=md-nav__item> <a href=#manage-the-chaos-toolkit-experiments class=md-nav__link> Manage the Chaos Toolkit Experiments </a> <nav class=md-nav aria-label="Manage the Chaos Toolkit Experiments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#list-and-inspect-experiments class=md-nav__link> List and inspect experiments </a> </li> <li class=md-nav__item> <a href=#delete-the-experiment-runs-resources class=md-nav__link> Delete the experiment run's resources </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#various-configurations class=md-nav__link> Various configurations </a> <nav class=md-nav aria-label="Various configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-the-toolkit-with-environment-variables class=md-nav__link> Configure the toolkit with environment variables </a> </li> <li class=md-nav__item> <a href=#handle-multiple-experiment-files class=md-nav__link> Handle multiple experiment files </a> </li> <li class=md-nav__item> <a href=#load-the-experiment-from-a-url class=md-nav__link> Load the experiment from a URL </a> </li> <li class=md-nav__item> <a href=#run-experiments-in-another-namespace class=md-nav__link> Run experiments in another namespace </a> </li> <li class=md-nav__item> <a href=#pass-chaos-toolkit-settings-as-a-kubernetes-secret class=md-nav__link> Pass Chaos Toolkit settings as a Kubernetes secret </a> </li> <li class=md-nav__item> <a href=#keep-generated-resources-even-when-the-cro-is-deleted class=md-nav__link> Keep generated resources even when the CRO is deleted </a> </li> <li class=md-nav__item> <a href=#pass-your-own-role-to-bind-to-the-service-account class=md-nav__link> Pass your own role to bind to the service account </a> </li> <li class=md-nav__item> <a href=#override-the-default-chaos-command-arguments class=md-nav__link> Override the default chaos command arguments </a> </li> <li class=md-nav__item> <a href=#label-your-chaos-toolkit-experiment class=md-nav__link> Label your Chaos Toolkit experiment </a> </li> <li class=md-nav__item> <a href=#allow-network-traffic-for-chaos-toolkit-experiments class=md-nav__link> Allow network traffic for Chaos Toolkit experiments </a> </li> <li class=md-nav__item> <a href=#run-periodic-and-recurring-experiments class=md-nav__link> Run periodic and recurring experiments </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-an-experiment-with-specific-extensions class=md-nav__link> Run an experiment with specific extensions </a> </li> <li class=md-nav__item> <a href=#uninstall-the-operator class=md-nav__link> Uninstall the operator </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Tutorials <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/tutorial/ title="Get Started with the Chaos Toolkit" class=md-nav__link> Get Started with the Chaos Toolkit </a> </li> <li class=md-nav__item> <a href=../../../reference/tutorials/authoring_operating/ title="Author and Operator" class=md-nav__link> Author and Operator </a> </li> <li class=md-nav__item> <a href=../../../reference/tutorials/tolerance/ title="Learn all about Steady-State Tolerances" class=md-nav__link> Learn all about Steady-State Tolerances </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Drivers Reference <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Drivers Reference" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Drivers Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drivers/overview/ title=Overview class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Infrastructure/Platform <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Infrastructure/Platform data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Infrastructure/Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drivers/aws/ title=AWS class=md-nav__link> AWS </a> </li> <li class=md-nav__item> <a href=../../../drivers/azure/ title=Azure class=md-nav__link> Azure </a> </li> <li class=md-nav__item> <a href=../../../drivers/cloudfoundry/ title="Cloud Foundry" class=md-nav__link> Cloud Foundry </a> </li> <li class=md-nav__item> <a href=../../../drivers/gandi/ title=Gandi class=md-nav__link> Gandi </a> </li> <li class=md-nav__item> <a href=../../../drivers/gcp/ title="Google Cloud Platform" class=md-nav__link> Google Cloud Platform </a> </li> <li class=md-nav__item> <a href=../../../drivers/kubernetes/ title=Kubernetes class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../drivers/service-fabric/ title="Service Fabric" class=md-nav__link> Service Fabric </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Application <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Application data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drivers/spring/ title=Spring class=md-nav__link> Spring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Network <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Network data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Network </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drivers/toxiproxy/ title=ToxiProxy class=md-nav__link> ToxiProxy </a> </li> <li class=md-nav__item> <a href=../../../drivers/istio/ title=Istio class=md-nav__link> Istio </a> </li> <li class=md-nav__item> <a href=../../../drivers/wiremock/ title=WireMock class=md-nav__link> WireMock </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Observability <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Observability data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../drivers/humio/ title=Humio class=md-nav__link> Humio </a> </li> <li class=md-nav__item> <a href=../../../drivers/prometheus/ title=Prometheus class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=../../../drivers/opentracing/ title="Open Tracing" class=md-nav__link> Open Tracing </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Chaos Open API <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Chaos Open API" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Chaos Open API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/concepts/ title=Concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=../../../reference/api/experiment/ title=Experiment class=md-nav__link> Experiment </a> </li> <li class=md-nav__item> <a href=../../../reference/api/journal/ title=Journal class=md-nav__link> Journal </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Contribute <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Contribute data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Contribute </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/contributing/ title="Contributing to the Chaos Toolkit" class=md-nav__link> Contributing to the Chaos Toolkit </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Project Management <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Project Management" data-md-level=2> <label class=md-nav__title for=nav-7-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Project Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/developing/values/ title="Key Project Values" class=md-nav__link> Key Project Values </a> </li> <li class=md-nav__item> <a href=../../../reference/developing/core/ title="Core Projects" class=md-nav__link> Core Projects </a> </li> <li class=md-nav__item> <a href=../../../reference/developing/technologies/ title="Technology Choices" class=md-nav__link> Technology Choices </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Develop <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Develop data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Develop </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/developing/guidelines/ title=Guidelines class=md-nav__link> Guidelines </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Driver Extension <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Driver Extension" data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Driver Extension </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/extending/approaches/ title="Extension Approaches" class=md-nav__link> Extension Approaches </a> </li> <li class=md-nav__item> <a href=../../../reference/extending/extending-with-python/ title="Extend with Python" class=md-nav__link> Extend with Python </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Control Extension <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Control Extension" data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Control Extension </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/extending/create-control-extension/ title="Create Control" class=md-nav__link> Create Control </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Resources <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Resources data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../resources/logos/ title=Logos class=md-nav__link> Logos </a> </li> <li class=md-nav__item> <a href=../../../resources/slides/ title=Slides class=md-nav__link> Slides </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#deploy-the-operator class=md-nav__link> Deploy the operator </a> </li> <li class=md-nav__item> <a href=#run-an-experiment class=md-nav__link> Run an experiment </a> </li> <li class=md-nav__item> <a href=#manage-the-chaos-toolkit-experiments class=md-nav__link> Manage the Chaos Toolkit Experiments </a> <nav class=md-nav aria-label="Manage the Chaos Toolkit Experiments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#list-and-inspect-experiments class=md-nav__link> List and inspect experiments </a> </li> <li class=md-nav__item> <a href=#delete-the-experiment-runs-resources class=md-nav__link> Delete the experiment run's resources </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#various-configurations class=md-nav__link> Various configurations </a> <nav class=md-nav aria-label="Various configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-the-toolkit-with-environment-variables class=md-nav__link> Configure the toolkit with environment variables </a> </li> <li class=md-nav__item> <a href=#handle-multiple-experiment-files class=md-nav__link> Handle multiple experiment files </a> </li> <li class=md-nav__item> <a href=#load-the-experiment-from-a-url class=md-nav__link> Load the experiment from a URL </a> </li> <li class=md-nav__item> <a href=#run-experiments-in-another-namespace class=md-nav__link> Run experiments in another namespace </a> </li> <li class=md-nav__item> <a href=#pass-chaos-toolkit-settings-as-a-kubernetes-secret class=md-nav__link> Pass Chaos Toolkit settings as a Kubernetes secret </a> </li> <li class=md-nav__item> <a href=#keep-generated-resources-even-when-the-cro-is-deleted class=md-nav__link> Keep generated resources even when the CRO is deleted </a> </li> <li class=md-nav__item> <a href=#pass-your-own-role-to-bind-to-the-service-account class=md-nav__link> Pass your own role to bind to the service account </a> </li> <li class=md-nav__item> <a href=#override-the-default-chaos-command-arguments class=md-nav__link> Override the default chaos command arguments </a> </li> <li class=md-nav__item> <a href=#label-your-chaos-toolkit-experiment class=md-nav__link> Label your Chaos Toolkit experiment </a> </li> <li class=md-nav__item> <a href=#allow-network-traffic-for-chaos-toolkit-experiments class=md-nav__link> Allow network traffic for Chaos Toolkit experiments </a> </li> <li class=md-nav__item> <a href=#run-periodic-and-recurring-experiments class=md-nav__link> Run periodic and recurring experiments </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-an-experiment-with-specific-extensions class=md-nav__link> Run an experiment with specific extensions </a> </li> <li class=md-nav__item> <a href=#uninstall-the-operator class=md-nav__link> Uninstall the operator </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/chaostoolkit/chaostoolkit/edit/master/docs/deployment/k8s/operator.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=deploy-chaos-toolkit-as-a-kubernetes-operator>Deploy Chaos Toolkit as a Kubernetes Operator<a class=headerlink href=#deploy-chaos-toolkit-as-a-kubernetes-operator title="Permanent link">&para;</a></h1> <p>Kubernetes operators are a popular approach to create bespoke controllers of any application on top of the Kubernetes API.</p> <p>The Chaos Toolkit operator listens for experiment declarations and triggers a new Kubernetes pod, running the Chaos Toolkit with the specified experiment.</p> <h2 id=deploy-the-operator>Deploy the operator<a class=headerlink href=#deploy-the-operator title="Permanent link">&para;</a></h2> <p>The <a href=https://github.com/chaostoolkit-incubator/kubernetes-crd>operator</a> can be found on the Chaos Toolkit incubator.</p> <p>It is deployed via typical Kubernetes <a href=https://github.com/chaostoolkit-incubator/kubernetes-crd/tree/master/manifests>manifests</a> which need to be applied via <a href=https://kustomize.io/ >Kustomize</a>, the native configuration manager.</p> <p>First, download the <a href=https://github.com/kubernetes-sigs/kustomize/blob/master/docs/INSTALL.md>Kustomize binary</a>:</p> <div class=highlight><pre><span></span><code>$ curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot; | bash
</code></pre></div> <p>For macOS, you can also install it via the Homebrew package manager: </p> <div class=highlight><pre><span></span><code>$ brew install kustomize
</code></pre></div> <p>Next, simply run the following:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kustomize build manifests/overlays/generic-rbac <span class=p>|</span> kubectl apply -f -
</code></pre></div> <p>This will build the manifests and apply them on your current default cluster. Notice how we use the RBAC variant of the deployment. If you have other requirements (no-RBAC, pod security or network policies), then check the <a href=https://github.com/chaostoolkit-incubator/kubernetes-crd>operator&rsquo;s documentation</a> to deploy the appropriate variant.</p> <p>You can install another variant as follows:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kustomize build manifests/overlays/generic<span class=o>[</span>-rbac<span class=o>[</span>-podsec<span class=o>[</span>-netsec<span class=o>]]]</span> <span class=p>|</span> kubectl apply -f -
</code></pre></div> <p>By now, you should have the operator running in the <code>chaostoolkit-crd</code>.</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kubectl -n chaostoolkit-crd get pods
<span class=go>NAME                                READY   STATUS    RESTARTS   AGE</span>
<span class=go>chaostoolkit-crd-7ddb9b78d9-dgxx7   1/1     Running   0          35s</span>
</code></pre></div> <p>The operator deployment created two namespaces, by default: - the <code>chaostoolkit-crd</code> namespace contains the operator pod and Chaos Toolkit experiment definitions - the <code>chaostoolkit-run</code> namespace contains pods running the Chaos Toolkit experiments</p> <h2 id=run-an-experiment>Run an experiment<a class=headerlink href=#run-an-experiment title="Permanent link">&para;</a></h2> <p>Now that your controller is listening, you can ask it to schedule a Chaos Toolkit experiment by applying a resource with the following API:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
</code></pre></div> <p>Below is a basic example, assuming a file named <code>basic.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>experiment.json</span><span class=p>:</span> <span class="p p-Indicator">|</span>
    <span class=no>{</span>
      <span class=no>&quot;version&quot;: &quot;1.0.0&quot;,</span>
      <span class=no>&quot;title&quot;: &quot;Hello world!&quot;,</span>
      <span class=no>&quot;description&quot;: &quot;Say hello world.&quot;,</span>
      <span class=no>&quot;method&quot;: [</span>
        <span class=no>{</span>
          <span class=no>&quot;type&quot;: &quot;action&quot;,</span>
          <span class=no>&quot;name&quot;: &quot;say-hello&quot;,</span>
          <span class=no>&quot;provider&quot;: {</span>
            <span class=no>&quot;type&quot;: &quot;process&quot;,</span>
            <span class=no>&quot;path&quot;: &quot;echo&quot;,</span>
            <span class=no>&quot;arguments&quot;: &quot;hello&quot;</span>
          <span class=no>}</span>
        <span class=no>}</span>
      <span class=no>]</span>
    <span class=no>}</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
</code></pre></div> <p>First, we will use the default namespace in which the Chaos Toolkit will run.</p> <p>Then, we need a config map to pass the experiment to execute.</p> <p>Finally, we simply create a <code>ChaosToolkitExperiment</code> object that the controller picks up and understand as a new experiment to run in its own pod.</p> <p>Apply it as follows:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kubectl apply -f basic.yaml
</code></pre></div> <p>Then, you can check the Chaos Toolkit experiment has been registered, and will be scheduled to run as soon as possible:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kubectl -n chaostoolkit-crd get ctks
</code></pre></div> <p>Look at the Chaos Toolkit running:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kubectl -n chaostoolkit-run get pods
</code></pre></div> <p>The status of the experiment&rsquo;s run, if it deviated, defines the status if the pod. So, when the experiment does deviate, the pod should have a status set to <code>Error</code>. Otherwise, the status will be <code>Completed</code>.</p> <h2 id=manage-the-chaos-toolkit-experiments>Manage the Chaos Toolkit Experiments<a class=headerlink href=#manage-the-chaos-toolkit-experiments title="Permanent link">&para;</a></h2> <h3 id=list-and-inspect-experiments>List and inspect experiments<a class=headerlink href=#list-and-inspect-experiments title="Permanent link">&para;</a></h3> <p>You can list your experiments as follows:</p> <div class=highlight><pre><span></span><code>$ kubectl -n chaostoolkit-crd get chaosexperiments 
</code></pre></div> <p>You can describe one experiment as follows:</p> <div class=highlight><pre><span></span><code>$ kubectl -n chaostoolkit-crd describe chaosexperiment my-chaos-exp 
</code></pre></div> <p>You can also use the short names for the custom resource <code>ctks</code> and <code>ctk</code>.</p> <h3 id=delete-the-experiment-runs-resources>Delete the experiment run&rsquo;s resources<a class=headerlink href=#delete-the-experiment-runs-resources title="Permanent link">&para;</a></h3> <p>You can delete an experiment and its related resources as follows:</p> <div class=highlight><pre><span></span><code>$ kubectl -n chaostoolkit-crd delete ctk my-chaos-exp 
</code></pre></div> <p>However, the custom resources (ConfigMap, Secrets, etc.) won&rsquo;t be deleted. This command only deletes the resources that the operator creates for the experiment to be able to run.</p> <p>To delete all the run&rsquo;s resources, simply delete the objects as follows:</p> <div class=highlight><pre><span></span><code>$ kubectl delete -f basic.yaml
</code></pre></div> <h2 id=various-configurations>Various configurations<a class=headerlink href=#various-configurations title="Permanent link">&para;</a></h2> <p>You may decide to change various aspects of the final pod (such as passing settings as secrets, changing the roles allowed to the pod, even override the entire pod template).</p> <h3 id=configure-the-toolkit-with-environment-variables>Configure the toolkit with environment variables<a class=headerlink href=#configure-the-toolkit-with-environment-variables title="Permanent link">&para;</a></h3> <p>Chaos Toolkit experiments often expect data to be passed as environment variables of the <code>chaos</code>&lsquo;s command shell.</p> <p>The operator allows you to specify those values through the config map:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-env</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>NAME</span><span class=p>:</span> <span class=s>&quot;Jane</span><span class=nv> </span><span class=s>Doe&quot;</span>
</code></pre></div> <p>They will be injected into the Chaos Toolkit&rsquo;s pod as environment variables.</p> <p>You might need several environment config maps for various experiments. You can tell the operator where to find the config map to be loaded as environment variables.</p> <p>We&rsquo;ll assume you defined another config map named <code>my-chaos-env-vars</code>. You can use it by setting the <code>configMapName</code> in the <code>env</code> block of the pod spec: </p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>env</span><span class=p>:</span>
      <span class=nt>configMapName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-env-vars</span>
</code></pre></div> <p>You can disable loading environment variables into the pod by using the <code>enabled</code> property:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>env</span><span class=p>:</span>
      <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div> <p>Plain text environment variables might not be secure enough in some use cases, such as database user name &amp; passord, API keys, tokens, etc. You can define multiple encrypted key-value pairs in a Kubernetes secret and load them as environment variables. To to so, you shall indicate the name of the secret with the <code>secretName</code> property.</p> <p>Assuming you created a generic secret named <code>chaostoolkit-secrets</code>, you can load the values as shown below: <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>env</span><span class=p>:</span>
      <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-secrets</span>
</code></pre></div></p> <p>All the key-value pairs from the secret will be injected into the Chaos Toolkit&rsquo;s pod as environment variables.</p> <h3 id=handle-multiple-experiment-files>Handle multiple experiment files<a class=headerlink href=#handle-multiple-experiment-files title="Permanent link">&para;</a></h3> <p>In the basic example, the name of the config map holding the experiment is the default value <code>chaostoolkit-experiment</code>. Usually, you&rsquo;ll want a more unique name since you&rsquo;ll probably run multiple experiments from the <code>chaostoolkit-run</code> namespace.</p> <p>In that case, do it as follows:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment-1234</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>experiment.json</span><span class=p>:</span> <span class="p p-Indicator">|</span>
    <span class=no>{</span>
        <span class=no>&quot;title&quot;: &quot;...&quot;,</span>
    <span class=no>}</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>experiment</span><span class=p>:</span>
      <span class=nt>configMapName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment-1234</span>
</code></pre></div> <p>You need to define the <code>configMapName</code> in the <code>experiment</code> block of the pod spec. </p> <h3 id=load-the-experiment-from-a-url>Load the experiment from a URL<a class=headerlink href=#load-the-experiment-from-a-url title="Permanent link">&para;</a></h3> <p>By default, the experiment is read from a file. But you may store it remotely e.g. GitHub and have it available over HTTP. You might want to load it from its remote URL instead.</p> <p>You can tell the Chaos Toolkit to load it from a remote URL rather than from a local file, as follows:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-env</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>EXPERIMENT_URL</span><span class=p>:</span> <span class=s>&quot;https://example.com/experiment.json&quot;</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>experiment</span><span class=p>:</span>
      <span class=nt>asFile</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div> <p>First, you need to pass the <code>EXPERIMENT_URL</code> environment variable.</p> <p>Then, tell the operator not to mount the default experiment volume. To do so, you need to set <code>asFile</code> to <code>false</code> in the <code>experiment</code> block of the pod spec.</p> <h3 id=run-experiments-in-another-namespace>Run experiments in another namespace<a class=headerlink href=#run-experiments-in-another-namespace title="Permanent link">&para;</a></h3> <p>You may create the namespace in which the resources will be deployed:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-other-namespace</span>
</code></pre></div> <p>You need to defined the <code>namespace</code> value at the spec level.</p> <p>If the namespace already exists, a message will be logged but this will not abort the operation.</p> <p>However, this namespace will be entirely under your responsibility. No network nor pod securities will be managed in your namespace, if the operator was installed with those variants. You&rsquo;ll need to manage them yourself. </p> <h3 id=pass-chaos-toolkit-settings-as-a-kubernetes-secret>Pass Chaos Toolkit settings as a Kubernetes secret<a class=headerlink href=#pass-chaos-toolkit-settings-as-a-kubernetes-secret title="Permanent link">&para;</a></h3> <p>Chaos Toolkit reads its settings from a file and you can pass yours by creating a Kubernetes secret named, by default, <code>chaostoolkit-settings</code>.</p> <p>For instance, assuming you have a <a href=../../../reference/usage/settings/ >Chaos Toolkit settings file</a>, you can create a secret from it as follows:</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kubectl -n chaostoolkit-run <span class=se>\</span>
    create secret generic chaostoolkit-settings <span class=se>\</span>
    --from-file<span class=o>=</span>settings.yaml<span class=o>=</span>./settings.yaml
</code></pre></div> <p>Note, the settings file must be named as <code>settings.yaml</code> within the secret.</p> <p>Reading settings is disabled by default, so you need to let the operator know it should allow it for that run:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>settings</span><span class=p>:</span>
      <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>You need to set the variable <code>enabled</code> to <code>true</code>in the <code>settings</code> block of the pod spec.</p> <p>The default name for that secret is <code>chaostoolkit-settings</code> but you can change it with the <code>secretName</code> variable, as follows:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>settings</span><span class=p>:</span>
      <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-super-secret</span>
</code></pre></div> <h3 id=keep-generated-resources-even-when-the-cro-is-deleted>Keep generated resources even when the CRO is deleted<a class=headerlink href=#keep-generated-resources-even-when-the-cro-is-deleted title="Permanent link">&para;</a></h3> <p>When you delete the <code>ChaosToolkitExperiment</code> resource, all the allocated resources are deleted too (pod, service account, &hellip;). To prevent this, you may set the <code>keep_resources_on_delete</code> property to <code>true</code> at the spec level. </p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>keep_resources_on_delete</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>In that case, you are responsible to cleanup all resources.</p> <h3 id=pass-your-own-role-to-bind-to-the-service-account>Pass your own role to bind to the service account<a class=headerlink href=#pass-your-own-role-to-bind-to-the-service-account title="Permanent link">&para;</a></h3> <p>If your cluster has enabled RBAC, then the operator automatically binds a basic role to the service account associated with the chaostoolkit pod. That role allows your experiment to create/get/list/delete other pods in the same namespace.</p> <p>You probably have more specific requirements, here is how to do it:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>role</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-role</span>
</code></pre></div> <p>The property <code>name</code> should be set to the name of the role you have created in the namespace which the experiment is executed in. The service account associated with the pod will be bound to that role.</p> <h3 id=override-the-default-chaos-command-arguments>Override the default chaos command arguments<a class=headerlink href=#override-the-default-chaos-command-arguments title="Permanent link">&para;</a></h3> <p>The pod template executes the <code>chaos run</code> command by default. You may want to extends or change the sub-command to execute when running the pod. You can define the <code>chaos</code> arguments as follow:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>chaosArgs</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--verbose</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">run</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--dry</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$(EXPERIMENT_PATH)</span>
</code></pre></div> <p>You need to set the list of arguments in the <code>chaosArgs</code> variable at pod spec level.</p> <h3 id=label-your-chaos-toolkit-experiment>Label your Chaos Toolkit experiment<a class=headerlink href=#label-your-chaos-toolkit-experiment title="Permanent link">&para;</a></h3> <p>Experiment labels can be defined in the <code>ChaosToolkitExperiment</code>&lsquo;s metadata. All labels will be forwarded, if not already defined, in the pod running the experiment.</p> <p>You can define labels as follow:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>environment</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
    <span class=nt>tier</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">backend</span>
    <span class=nt>target</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">database</span>
</code></pre></div> <p>These labels can then be used as selectors.</p> <h3 id=allow-network-traffic-for-chaos-toolkit-experiments>Allow network traffic for Chaos Toolkit experiments<a class=headerlink href=#allow-network-traffic-for-chaos-toolkit-experiments title="Permanent link">&para;</a></h3> <p>When the operator is installed with the network security variant, the <code>chaostoolkit</code> pod has limited network access. The pod is, by default, isolated for ingress connectivity and is limited to only DNS lookup &amp; HTTPS for external traffic.</p> <p>To allow the pod for other access, you may create another network policy within the <code>chaostoolkit-run</code> namespace for pods matching the <code>app: chaostoolkit</code> label:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-network-policy</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>podSelector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit</span>
</code></pre></div> <h3 id=run-periodic-and-recurring-experiments>Run periodic and recurring experiments<a class=headerlink href=#run-periodic-and-recurring-experiments title="Permanent link">&para;</a></h3> <p>The operator supports <code>crontab</code> schedule for running Chaos Toolkit experiments periodically on a given schedule.</p> <p>To do so, you can define a <code>.spec.schedule</code> section, as follow:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>schedule</span><span class=p>:</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cronJob</span>
    <span class=nt>value</span><span class=p>:</span> <span class=s>&quot;*/1</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span>
</code></pre></div> <p>This example runs a Chaos Toolkit experiment every minute.</p> <p>You can list your scheduled experiments with the kubernetes&rsquo; <code>cronjob</code> resource:</p> <div class=highlight><pre><span></span><code>$ kubectl -n chaostoolkit-run get cronjobs
</code></pre></div> <h2 id=run-an-experiment-with-specific-extensions>Run an experiment with specific extensions<a class=headerlink href=#run-an-experiment-with-specific-extensions title="Permanent link">&para;</a></h2> <p>The default container image used by the operator is the official <a href=https://raw.githubusercontent.com/chaostoolkit/chaostoolkit/master/Dockerfile>Chaos Toollkit image</a> which embeds no <a href=../../../drivers/overview/ >Chaos Toolkit extensions</a>.</p> <p>This means that you will likely need to create your bespoke container image. For instance, to install the Chaos Toolkit Kubernetes extension, create a Dockerfile like this:</p> <div class=highlight><pre><span></span><code><span class=k>FROM</span> <span class=s>chaostoolkit/chaostoolkit</span>

<span class=k>RUN</span> apk update <span class=o>&amp;&amp;</span> <span class=se>\</span>
    apk add --virtual build-deps libffi-dev openssl-dev gcc python3-dev musl-dev <span class=o>&amp;&amp;</span> <span class=se>\</span>
    pip install --no-cache-dir chaostoolkit-kubernetes <span class=o>&amp;&amp;</span> <span class=se>\</span>
    apk del build-deps
</code></pre></div> <p>Then create the image with docker:</p> <div class=highlight><pre><span></span><code>$ docker build --tag my/chaostoolkit -f ./Dockerfile .
</code></pre></div> <p>or, something such as <a href=https://podman.io/ >Podman</a>:</p> <div class=highlight><pre><span></span><code>$ podman build --tag my/chaostoolkit -f ./Dockerfile
</code></pre></div> <p>You can check your image contains the installed extensions as follows:</p> <div class=highlight><pre><span></span><code>$ docker run --rm -it my/chaostoolkit info extensions
</code></pre></div> <p>Once this image is pushed to any registry you can access, you need to let the operator know it must use it.</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class=nt>pod</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my/chaostoolkit</span>
</code></pre></div> <h2 id=uninstall-the-operator>Uninstall the operator<a class=headerlink href=#uninstall-the-operator title="Permanent link">&para;</a></h2> <p>To uninstall the operator and its own resources, simply run the following command for the overlay that is deployed.</p> <div class=highlight><pre><span></span><code><span class=gp>$</span> kustomize build manifests/overlays/generic<span class=o>[</span>-rbac<span class=o>[</span>-podsec<span class=o>[</span>-netsec<span class=o>]]]</span> <span class=p>|</span> kubectl delete -f -
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../../../reference/usage/scheduling/ title=Schedule class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Schedule </div> </div> </a> <a href=../../../reference/tutorial/ title="Get Started with the Chaos Toolkit" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Get Started with the Chaos Toolkit </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2017-2020 Chaos Toolkit team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/chaostoolkit target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/chaostoolkit target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://join.chaostoolkit.org/ target=_blank rel=noopener title=join.chaostoolkit.org class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://medium.com/chaos-toolkit target=_blank rel=noopener title=medium.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.d1f5a259.min.js></script> <script src=../../../assets/javascripts/bundle.d5fec882.min.js></script><script id=__lang type=application/json>{"search.config.pipeline": "trimmer, stopWordFilter", "search.result.other": "# matching documents", "search.config.separator": "[\\s\\-]+", "search.result.none": "No matching documents", "search.result.placeholder": "Type to start searching", "search.config.lang": "en", "clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.result.one": "1 matching document"}</script> <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>